// prisma/schema.prisma

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider          = "postgresql"
  url               = env("DATABASE_URL")
  shadowDatabaseUrl = env("SHADOW_DATABASE_URL")
}

// --- Prisma schema (schema.prisma) ---
// Updated: Directory <-> ServiceType many-to-many via DirectoryService

// Run: npx prisma migrate dev --name add-multiple-services

model User {
  id              Int         @id @default(autoincrement())
  name            String
  phone           String
  email           String      @unique
  idNumber        String      @db.Char(16)
  role            Role
  password        String?
  emailVerified   Boolean     @default(false)
  activationToken String?
  createdAt       DateTime    @default(now())
  updatedAt       DateTime    @updatedAt
  disabled        Boolean     @default(false)
  directories     Directory[] // back-reference to created directories

  @@map("users")
}


enum Urgency {
  VICTIMS_OF_ABUSE_EXPLOITATION
  STREET_CHILDREN
  REFUGEE_CHILDREN
  CHILDREN_WITH_DISABILITIES
  EXTREME_POVERTY
  SEPARATED_OR_ABANDONED
  CHILDREN_IN_JUSTICE_SYSTEM
  HARMFUL_PRACTICES
}

enum Role {
  ADMIN
  ENUMERATOR
}

enum Category {
  GOVERNMENT
  NON_GOVERNMENTAL
  COMMUNITY_BASED
}

model ServiceType {
  id          Int                @id @default(autoincrement())
  name        String             @unique
  directories DirectoryService[]
}

model Directory {
  id                  Int       @id @default(autoincrement())
  nameOfOrganization  String
  category            String
  email               String
  phone               String
  website             String?
  paid                Boolean   @default(false)
  amount              Float?
  estimatedAttendance Int
  districtId          Int
  district            District   @relation(fields: [districtId], references: [id])
  sectorId            Int
  sector              Sector     @relation(fields: [sectorId], references: [id])
  cellId              Int
  cell                Cell       @relation(fields: [cellId], references: [id])
  villageId           Int
  village             Village    @relation(fields: [villageId], references: [id])
  createdById         Int
  createdBy           User       @relation(fields: [createdById], references: [id])
  urgency             Urgency
  description         String?
  otherServices       String?
  services            DirectoryService[]
}

model DirectoryService {
  id          Int       @id @default(autoincrement())
  directory   Directory @relation(fields: [directoryId], references: [id])
  directoryId Int
  service     ServiceType @relation(fields: [serviceId], references: [id])
  serviceId   Int
}


model District {
  id          Int         @id @default(autoincrement())
  name        String      @unique
  sectors     Sector[]
  directories Directory[]
}

model Sector {
  id          Int         @id @default(autoincrement())
  name        String
  district    District    @relation(fields: [districtId], references: [id])
  districtId  Int
  cells       Cell[]
  directories Directory[]
}

model Cell {
  id          Int         @id @default(autoincrement())
  name        String
  sector      Sector      @relation(fields: [sectorId], references: [id])
  sectorId    Int
  villages    Village[]
  directories Directory[]
}

model Village {
  id          Int         @id @default(autoincrement())
  name        String
  cell        Cell        @relation(fields: [cellId], references: [id])
  cellId      Int
  directories Directory[]
}
